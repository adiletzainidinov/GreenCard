(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{796:function(e,t,n){"use strict";n.r(t),n.d(t,"FILE_TYPE",(function(){return _})),n.d(t,"default",(function(){return K}));var r=n(3),a=n(6),i=n(11),o=n(12),u=n(9);function c(e,t){this.v=e,this.k=t}function s(e){return new c(e,0)}function f(e){var t,n;function r(t,n){try{var i=e[t](n),o=i.value,u=o instanceof c;Promise.resolve(u?o.v:o).then((function(n){if(u){var c="return"===t?"return":"next";if(!o.k||n.done)return r(c,n);n=e[c](n).value}a(i.done?"return":"normal",n)}),(function(e){r("throw",e)}))}catch(s){a("throw",s)}}function a(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,a){return new Promise((function(i,o){var u={key:e,arg:a,resolve:i,reject:o,next:null};n?n=n.next=u:(t=n=u,r(e,a))}))},"function"!=typeof e.return&&(this.return=void 0)}f.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},f.prototype.next=function(e){return this._invoke("next",e)},f.prototype.throw=function(e){return this._invoke("throw",e)},f.prototype.return=function(e){return this._invoke("return",e)};var p,v,d=function(e,t){return t.some((function(t){return e instanceof t}))};var h=new WeakMap,l=new WeakMap,b=new WeakMap;var y={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function w(e){y=e(y)}function k(e){return(v||(v=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(x(this),n),m(this.request)}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return m(e.apply(x(this),n))}}function g(e){return"function"===typeof e?k(e):(e instanceof IDBTransaction&&function(e){if(!h.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=function(){t(),r()},i=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)}));h.set(e,t)}}(e),d(e,p||(p=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,y):e)}function m(e){if(e instanceof IDBRequest)return function(e){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("success",a),e.removeEventListener("error",i)},a=function(){t(m(e.result)),r()},i=function(){n(e.error),r()};e.addEventListener("success",a),e.addEventListener("error",i)}));return b.set(t,e),t}(e);if(l.has(e))return l.get(e);var t=g(e);return t!==e&&(l.set(e,t),b.set(t,e)),t}var x=function(e){return b.get(e)};function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,a=n.upgrade,i=n.blocking,o=n.terminated,u=indexedDB.open(e,t),c=m(u);return a&&u.addEventListener("upgradeneeded",(function(e){a(m(u.result),e.oldVersion,e.newVersion,m(u.transaction),e)})),r&&u.addEventListener("blocked",(function(e){return r(e.oldVersion,e.newVersion,e)})),c.then((function(e){o&&e.addEventListener("close",(function(){return o()})),i&&e.addEventListener("versionchange",(function(e){return i(e.oldVersion,e.newVersion,e)}))})).catch((function(){})),c}var j=["get","getKey","getAll","getAllKeys","count"],O=["put","add","delete","clear"],E=new Map;function D(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"===typeof t){if(E.get(t))return E.get(t);var n=t.replace(/FromIndex$/,""),i=t!==n,o=O.includes(n);if(n in(i?IDBIndex:IDBObjectStore).prototype&&(o||j.includes(n))){var u=function(){var e=Object(a.a)(Object(r.a)().mark((function e(t){var a,u,c,s,f,p,v=arguments;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(u=this.transaction(t,o?"readwrite":"readonly"),c=u.store,s=v.length,f=new Array(s>1?s-1:0),p=1;p<s;p++)f[p-1]=v[p];return i&&(c=c.index(f.shift())),e.next=6,Promise.all([(a=c)[n].apply(a,f),o&&u.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return E.set(t,u),u}}}w((function(e){return Object(u.a)(Object(u.a)({},e),{},{get:function(t,n,r){return D(t,n)||e.get(t,n,r)},has:function(t,n){return!!D(t,n)||e.has(t,n)}})}));var B=["continue","continuePrimaryKey","advance"],L={},A=new WeakMap,M=new WeakMap,C={get:function(e,t){if(!B.includes(t))return e[t];var n=L[t];return n||(n=L[t]=function(){var e;A.set(this,(e=M.get(this))[t].apply(e,arguments))}),n}};function S(){return P.apply(this,arguments)}function P(){var e;return e=Object(r.a)().mark((function e(){var t,n,a,i=arguments;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this)instanceof IDBCursor){e.next=5;break}return e.next=4,s((n=t).openCursor.apply(n,i));case 4:t=e.sent;case 5:if(t){e.next=7;break}return e.abrupt("return");case 7:a=new Proxy(t,C),M.set(a,t),b.set(a,x(t));case 11:if(!t){e.next=20;break}return e.next=14,a;case 14:return e.next=16,s(A.get(a)||t.continue());case 16:t=e.sent,A.delete(a),e.next=11;break;case 20:case"end":return e.stop()}}),e,this)})),P=function(){return new f(e.apply(this,arguments))},P.apply(this,arguments)}function F(e,t){return t===Symbol.asyncIterator&&d(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&d(e,[IDBIndex,IDBObjectStore])}w((function(e){return Object(u.a)(Object(u.a)({},e),{},{get:function(t,n,r){return F(t,n)?S:e.get(t,n,r)},has:function(t,n){return F(t,n)||e.has(t,n)}})}));var G=n(4),T=n(36),V=n.n(T),W={IMAGE:"userUploadImage"},_={LOCAL:"local"},K=function(){function e(){if(Object(i.a)(this,e),this.db=void 0,this.imgStore=void 0,e.instance)return e.instance;this.db=null,this.imgStore=null,e.instance=this}return Object(o.a)(e,[{key:"initDB",value:function(){var e=Object(a.a)(Object(r.a)().mark((function e(){return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I("FotorFeatureDB",1,{upgrade:function(e,t,n,r,a){e.createObjectStore(W.IMAGE)},blocked:function(e,t,n){},blocking:function(e,t,n){},terminated:function(){}});case 2:this.db=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addCacheImage",value:function(){var e=Object(a.a)(Object(r.a)().mark((function e(t){var n,a,i=arguments;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},this.db){e.next=3;break}return e.abrupt("return");case 3:if(a={file:t,width:n.width,height:n.height,key:n.key||V()(),from:n.from},t instanceof Blob){e.next=10;break}return a.width=t.width,a.height=t.height,e.next=9,G.f.canvas2File(t);case 9:a.file=e.sent;case 10:return e.next=12,this.db.put(W.IMAGE,a,a.key);case 12:return e.sent,e.abrupt("return",{key:a.key});case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCacheFile",value:function(){var e=Object(a.a)(Object(r.a)().mark((function e(t){var n;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.db){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.db.get(W.IMAGE,t);case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addCavas",value:function(){var e=Object(a.a)(Object(r.a)().mark((function e(t){var n,a,i;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=V()(),a=t,!(t instanceof HTMLCanvasElement)){e.next=7;break}return e.next=5,G.f.canvas2File(t,"image/jpeg",1);case 5:i=e.sent,a=new File([i],"".concat(n,".jpeg"),{type:i.type});case 7:return e.next=9,this.db.put(W.IMAGE,a,n);case 9:return e.sent,e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCacheImages",value:function(){var e=Object(a.a)(Object(r.a)().mark((function e(){var t;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.db){e.next=5;break}return e.next=3,this.db.getAll(W.IMAGE);case 3:return t=e.sent,e.abrupt("return",t);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeCacheImage",value:function(){var e=Object(a.a)(Object(r.a)().mark((function e(t){return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.db.delete(W.IMAGE,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clearImageCacheStore",value:function(){return this.db.clear(W.IMAGE)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}();K.instance=void 0}}]);